This code is licensed under the GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007.

"use strict";
"use strict";(()=>{var r={KEY_ESC:27,KEY_ENTER:13,KEY_CHAT:13,KEY_FIREFOOD:119,KEY_SPLIT:32,KEY_LEFT:65,KEY_UP:87,KEY_RIGHT:68,KEY_DOWN:83,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_AUTO_SPIN:67,KEY_AUTO_FIRE:69,KEY_OVER_RIDE:82,KEY_UPGRADE_ATK:49,KEY_UPGRADE_HTL:50,KEY_UPGRADE_SPD:51,KEY_UPGRADE_STR:52,KEY_UPGRADE_PEN:53,KEY_UPGRADE_DAM:54,KEY_UPGRADE_RLD:55,KEY_UPGRADE_MOB:56,KEY_UPGRADE_RGN:57,KEY_UPGRADE_SHI:48,KEY_MOUSE_0:32,KEY_MOUSE_1:86,KEY_MOUSE_2:16,KEY_CHOOSE_1:89,KEY_CHOOSE_2:72,KEY_CHOOSE_3:85,KEY_CHOOSE_4:74,KEY_CHOOSE_5:73,KEY_CHOOSE_6:75,KEY_CHOOSE_7:79,KEY_CHOOSE_8:76,KEY_LEVEL_UP:78,KEY_FUCK_YOU:191,screenWidth:window.innerWidth,screenHeight:window.innerHeight,gameWidth:0,gameHeight:0,xoffset:-0,yoffset:-0,gameStart:!1,disconnected:!1,died:!1,kicked:!1,continuity:!1,startPingTime:0,toggleMassState:0,backgroundColor:"#f2fbff",lineColor:"#000000"},R=(function(o={}){return o.submitToLocalStorage=l=>(localStorage.setItem(l+"Value",document.getElementById(l).value),localStorage.setItem(l+"Checked",document.getElementById(l).checked),!1),o.retrieveFromLocalStorage=l=>(document.getElementById(l).value=localStorage.getItem(l+"Value"),document.getElementById(l).checked=localStorage.getItem(l+"Checked")==="true",!1),o.handleLargeNumber=(l,e=!1)=>e&&l==0?"":l<Math.pow(10,3)?""+l.toFixed(0):l<Math.pow(10,6)?(l/Math.pow(10,3)).toFixed(2)+"k":l<Math.pow(10,9)?(l/Math.pow(10,6)).toFixed(2)+"m":l<Math.pow(10,12)?(l/Math.pow(10,9)).toFixed(2)+"b":l<Math.pow(10,15)?(l/Math.pow(10,12)).toFixed(2)+"t":(l/Math.pow(10,15)).toFixed(2)+"q",o.timeForHumans=l=>{let e=l%60;l/=60,l=Math.floor(l);let n=l%60;l/=60,l=Math.floor(l);let a=l%24;l/=24,l=Math.floor(l);let i=l,t="";function s(p,m){p&&(t=t+(t===""?"":", ")+p+" "+m+(p>1?"s":""))}return s(i,"day"),s(a,"hour"),s(n,"minute"),s(e,"second"),t===""&&(t="less than a second"),t},o.addArticle=l=>/[aeiouAEIOU]/.test(l[0])?"an "+l:"a "+l,o.formatLargeNumber=l=>l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),o.pullJSON=l=>{let e=new XMLHttpRequest,n="/json/"+l+".json?v="+VERSION;return console.log("Loading JSON from "+n),e.responseType="json",new Promise((a,i)=>{e.open("GET",n),e.onload=()=>{a(e.response),console.log("JSON load complete.")},e.onerror=()=>{i(e.statusText),console.log("JSON load failed."),console.log(e.statusText)},e.send()})},o})(),H={graphical:{screenshotMode:!1,borderChunk:6,barChunk:5,mininumBorderChunk:3,deathBlurAmount:3,darkBorders:!1,fancyAnimations:!0,colors:"normal",pointy:!0,fontSizeBoost:1,neon:!1},gui:{expectedMaxSkillLevel:9},lag:{unresponsive:!1,memory:60}},g={};R.pullJSON("color").then(o=>g=o);var re=(()=>{function o(e){return e.toString(16)}function l(e){return parseInt(e,16)}return(e,n,a=.5)=>{if(a===1)return n;if(a===0)return e;for(var i="#",t=1;t<=6;t+=2){for(var s=l(n.substr(t,2)),p=l(e.substr(t,2)),m=o(Math.floor(p+(s-p)*a));m.length<2;)m="0"+m;i+=m}return i}})();function ee(o){switch(o){case 0:return g.teal;case 1:return g.lgreen;case 2:return g.orange;case 3:return g.yellow;case 4:return g.lavender;case 5:return g.pink;case 6:return g.vlgrey;case 7:return g.lgrey;case 8:return g.guiwhite;case 9:return g.black;case 10:return g.blue;case 11:return g.green;case 12:return g.red;case 13:return g.gold;case 14:return g.purple;case 15:return g.magenta;case 16:return g.grey;case 17:return g.dgrey;case 18:return g.white;case 19:return g.guiblack;default:return"#FF0000"}}function Se(o){let l=H.graphical.neon?g.white:g.black;return H.graphical.darkBorders?l:re(o,l,g.border)}function ve(o,l){switch(o){case"bas1":return g.blue;case"bas2":return g.green;case"bas3":return g.red;case"bas4":return g.pink;default:return l?g.white:g.lgrey}}function Me(o,l){H.graphical.neon?(o.fillStyle=Se(l),o.strokeStyle=l):(o.fillStyle=l,o.strokeStyle=Se(l))}var N=[];R.pullJSON("mockups").then(o=>N=o);function he(o,l=N[o].color){let e=N[o];return{time:0,index:o,x:e.x,y:e.y,vx:0,vy:0,size:e.size,realSize:e.realSize,color:l,render:{status:{getFade:()=>1,getColor:()=>"#FFFFFF",getBlend:()=>0,health:{get:()=>1},shield:{get:()=>1}}},facing:e.facing,shape:e.shape,name:e.name,score:0,tiggle:0,layer:e.layer,guns:{length:e.guns.length,getPositions:()=>{let n=[];return e.guns.forEach(()=>n.push(0)),n},update:()=>{}},turrets:e.turrets.map(n=>{let a=he(n.index);return a.realSize=a.realSize/a.size*e.size*n.sizeFactor,a.size=e.size*n.sizeFactor,a.angle=n.angle,a.offset=n.offset,a.direction=n.direction,a.facing=n.direction+n.angle,a})}}r.clickables=(()=>{let o=(()=>{function l(){let e={x:0,y:0,w:0,h:0},n=!1;return{set:(a,i,t,s)=>{e.x=a,e.y=i,e.w=t,e.h=s,n=!0},check:a=>{let i=Math.round(a.x-e.x),t=Math.round(a.y-e.y);return n&&i>=0&&t>=0&&i<=e.w&&t<=e.h},hide:()=>{n=!1}}}return e=>{let n=[];for(let a=0;a<e;a++)n.push(l());return{place:(a,...i)=>{if(a>=n.length)throw console.log(a),console.log(n),new Error("Trying to reference a clickable outside a region!");n[a].set(...i)},hide:()=>{n.forEach(a=>a.hide())},check:a=>n.findIndex(i=>i.check(a))}}})();return{stat:o(10),upgrade:o(8),hover:o(1),skipUpgrades:o(1)}})();r.statHover=!1;r.upgradeHover=!1;var b={id:-1,x:r.screenWidth/2,y:r.screenHeight/2,vx:0,vy:0,renderx:r.screenWidth/2,rendery:r.screenHeight/2,renderv:1,slip:0,view:1,time:0,screenWidth:r.screenWidth,screenHeight:r.screenHeight,target:{x:r.screenWidth/2,y:r.screenHeight/2}},$=[];var ie=[],ce=0,z=[];var P={latency:0,lag:0,rendertime:0,updatetime:0,lastlag:0,lastrender:0,rendergap:0,lastuplink:0},_e=0,ge=0,pe=0,fe={x:b.x,y:b.y},Q=[["norm"]],Ie=0,_={getStatNames:o=>{switch(o){case 1:return["Body Damage","Max Health","Bullet Speed","Bullet Health","Bullet Penetration","Bullet Damage","Engine Acceleration","Movement Speed","Shield Regeneration","Shield Capacity"];case 2:return["Body Damage","Max Health","Drone Speed","Drone Health","Drone Penetration","Drone Damage","Respawn Rate","Movement Speed","Shield Regeneration","Shield Capacity"];case 3:return["Body Damage","Max Health","Drone Speed","Drone Health","Drone Penetration","Drone Damage","Max Drone Count","Movement Speed","Shield Regeneration","Shield Capacity"];case 4:return["Body Damage","Max Health","Swarm Speed","Swarm Health","Swarm Penetration","Swarm Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];case 5:return["Body Damage","Max Health","Placement Speed","Trap Health","Trap Penetration","Trap Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];case 6:return["Body Damage","Max Health","Weapon Speed","Weapon Health","Weapon Penetration","Weapon Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];default:return["Body Damage","Max Health","Bullet Speed","Bullet Health","Bullet Penetration","Bullet Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"]}},skills:[{amount:0,color:"purple",cap:1,softcap:1},{amount:0,color:"pink",cap:1,softcap:1},{amount:0,color:"blue",cap:1,softcap:1},{amount:0,color:"lgreen",cap:1,softcap:1},{amount:0,color:"red",cap:1,softcap:1},{amount:0,color:"yellow",cap:1,softcap:1},{amount:0,color:"green",cap:1,softcap:1},{amount:0,color:"teal",cap:1,softcap:1},{amount:0,color:"gold",cap:1,softcap:1},{amount:0,color:"orange",cap:1,softcap:1}],points:0,upgrades:[],playerid:-1,__s:(()=>{let o=0,l=0,e=0,n=0,a=L(0,10);return{setScore:i=>{i?(a.set(i),e>a.get()&&(n=0,e=0)):(a=L(0,10),n=0)},update:()=>{l=Math.ceil(1.8*Math.pow(n+1,1.8)-2*n+1),a.get()-e>=l&&(e+=l,n+=1)},getProgress:()=>l?Math.min(1,Math.max(0,(a.get()-e)/l)):0,getScore:()=>a.get(),getLevel:()=>n}})(),type:0,fps:0,color:0,accel:0,topspeed:1};r.clearUpgrades=()=>{_.upgrades=[]};var ne=(()=>{let o={};function l(e="",n=0,a=0){let i=0,t=0,s=L(0,10);return{update:(p,m)=>{i=p,s.set(m)},publish:()=>{let p=N[i];return{image:he(i,a),position:p.position,barcolor:ee(n),label:e===""?p.name:e+" - "+p.name,score:s.get()}}}}return{get:()=>{let e=[],n=1;for(let a in o){if(!o.hasOwnProperty(a))continue;let i=o[a].publish();e.push(i),i.score>n&&(n=i.score)}return e.sort((a,i)=>i.score-a.score),{data:e,max:n}},remove:e=>{if(o["_"+e]===void 0)return console.log("Warning: Asked to removed an unknown leaderboard entry."),-1;delete o["_"+e]},add:e=>{let n=l(e.name,e.barcolor,e.color);n.update(e.index,e.score),o["_"+e.id]=n},update:e=>{if(o["_"+e.id]===void 0)return console.log("Warning: Asked to update an unknown leaderboard entry."),-1;o["_"+e.id].update(e.index,e.score)},purge:()=>{o={}}}})(),Ee=()=>Math.max(r.screenWidth/b.renderv,r.screenHeight/b.renderv/9*16);r.target=fe;r.player=b;r.canUpgrade=!1;r.canSkill=!1;r.message="";r.time=0;r.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);var de="Unknown Server";window.onload=()=>{switch(window.location.hostname){case"139.162.69.30":de="\u{1F1EF}\u{1F1F5} arras-linode-tokyo";break;case"172.104.9.164":de="\u{1F1FA}\u{1F1F8} arras-linode-newark";break}document.getElementById("serverName").innerHTML='<h4 class="nopadding">'+de+"</h4>",R.retrieveFromLocalStorage("playerNameInput"),R.retrieveFromLocalStorage("playerKeyInput"),R.retrieveFromLocalStorage("optScreenshotMode"),R.retrieveFromLocalStorage("optPredictive"),R.retrieveFromLocalStorage("optFancy"),R.retrieveFromLocalStorage("optColors"),R.retrieveFromLocalStorage("optNoPointy"),R.retrieveFromLocalStorage("optBorders"),document.getElementById("optColors").value===""&&(document.getElementById("optColors").value="normal"),document.getElementById("optBorders").value===""&&(document.getElementById("optBorders").value="normal"),document.getElementById("startButton").onclick=()=>Ue(),document.onkeydown=o=>{var l=o.which||o.keyCode;l===r.KEY_ENTER&&(r.dead||!r.gameStart)&&Ue()},window.addEventListener("resize",()=>{b.screenWidth=ke.width=r.screenWidth=window.innerWidth,b.screenHeight=ke.height=r.screenHeight=window.innerHeight})};var me=class{constructor(l){this.directionLock=!1,this.target=r.target,this.reenviar=!0,this.socket=r.socket,this.directions=[];var e=this;this.cv=document.getElementById("gameCanvas"),this.cv.width=r.screenWidth,this.cv.height=r.screenHeight,this.cv.addEventListener("mousemove",this.gameInput,!1),this.cv.addEventListener("keydown",this.keyboardDown,!1),this.cv.addEventListener("keyup",this.keyboardUp,!1),this.cv.addEventListener("mousedown",this.mouseDown,!1),this.cv.addEventListener("mouseup",this.mouseUp,!1),this.cv.parent=e,r.canvas=this}keyboardDown(l){switch(l.keyCode){case 13:r.died&&this.parent.socket.talk("s",r.playerName,0),r.died=!1;break;case r.KEY_UP_ARROW:case r.KEY_UP:this.parent.socket.cmd.set(0,!0);break;case r.KEY_DOWN_ARROW:case r.KEY_DOWN:this.parent.socket.cmd.set(1,!0);break;case r.KEY_LEFT_ARROW:case r.KEY_LEFT:this.parent.socket.cmd.set(2,!0);break;case r.KEY_RIGHT_ARROW:case r.KEY_RIGHT:this.parent.socket.cmd.set(3,!0);break;case r.KEY_MOUSE_0:this.parent.socket.cmd.set(4,!0);break;case r.KEY_MOUSE_1:this.parent.socket.cmd.set(5,!0);break;case r.KEY_MOUSE_2:this.parent.socket.cmd.set(6,!0);break;case r.KEY_LEVEL_UP:this.parent.socket.talk("L");break;case r.KEY_FUCK_YOU:this.parent.socket.talk("0");break}if(!l.repeat){switch(l.keyCode){case r.KEY_AUTO_SPIN:this.parent.socket.talk("t",0);break;case r.KEY_AUTO_FIRE:this.parent.socket.talk("t",1);break;case r.KEY_OVER_RIDE:this.parent.socket.talk("t",2);break}if(r.canSkill)switch(l.keyCode){case r.KEY_UPGRADE_ATK:this.parent.socket.talk("x",0);break;case r.KEY_UPGRADE_HTL:this.parent.socket.talk("x",1);break;case r.KEY_UPGRADE_SPD:this.parent.socket.talk("x",2);break;case r.KEY_UPGRADE_STR:this.parent.socket.talk("x",3);break;case r.KEY_UPGRADE_PEN:this.parent.socket.talk("x",4);break;case r.KEY_UPGRADE_DAM:this.parent.socket.talk("x",5);break;case r.KEY_UPGRADE_RLD:this.parent.socket.talk("x",6);break;case r.KEY_UPGRADE_MOB:this.parent.socket.talk("x",7);break;case r.KEY_UPGRADE_RGN:this.parent.socket.talk("x",8);break;case r.KEY_UPGRADE_SHI:this.parent.socket.talk("x",9);break}if(r.canUpgrade)switch(l.keyCode){case r.KEY_CHOOSE_1:this.parent.socket.talk("U",0);break;case r.KEY_CHOOSE_2:this.parent.socket.talk("U",1);break;case r.KEY_CHOOSE_3:this.parent.socket.talk("U",2);break;case r.KEY_CHOOSE_4:this.parent.socket.talk("U",3);break;case r.KEY_CHOOSE_5:this.parent.socket.talk("U",4);break;case r.KEY_CHOOSE_6:this.parent.socket.talk("U",5);break;case r.KEY_CHOOSE_7:this.parent.socket.talk("U",6);break;case r.KEY_CHOOSE_8:this.parent.socket.talk("U",7);break}}}keyboardUp(l){switch(l.keyCode){case r.KEY_UP_ARROW:case r.KEY_UP:this.parent.socket.cmd.set(0,!1);break;case r.KEY_DOWN_ARROW:case r.KEY_DOWN:this.parent.socket.cmd.set(1,!1);break;case r.KEY_LEFT_ARROW:case r.KEY_LEFT:this.parent.socket.cmd.set(2,!1);break;case r.KEY_RIGHT_ARROW:case r.KEY_RIGHT:this.parent.socket.cmd.set(3,!1);break;case r.KEY_MOUSE_0:this.parent.socket.cmd.set(4,!1);break;case r.KEY_MOUSE_1:this.parent.socket.cmd.set(5,!1);break;case r.KEY_MOUSE_2:this.parent.socket.cmd.set(6,!1);break}}mouseDown(l){switch(l.button){case 0:let e={x:l.clientX,y:l.clientY},n=r.clickables.stat.check(e);if(n!==-1)this.parent.socket.talk("x",n);else if(r.clickables.skipUpgrades.check(e)!==-1)r.clearUpgrades();else{let a=r.clickables.upgrade.check(e);a!==-1?this.parent.socket.talk("U",a):this.parent.socket.cmd.set(4,!0)}break;case 1:this.parent.socket.cmd.set(5,!0);break;case 2:this.parent.socket.cmd.set(6,!0);break}}mouseUp(l){switch(l.button){case 0:this.parent.socket.cmd.set(4,!1);break;case 1:this.parent.socket.cmd.set(5,!1);break;case 2:this.parent.socket.cmd.set(6,!1);break}}gameInput(l){this.parent.target.x=l.clientX-this.width/2,this.parent.target.y=l.clientY-this.height/2,r.target=this.parent.target,r.statHover=r.clickables.hover.check({x:l.clientX,y:l.clientY})===0}};window.canvas=new me;var ke=window.canvas.cv,k=ke.getContext("2d"),Pe=document.createElement("canvas"),ye=Pe.getContext("2d");ye.imageSmoothingEnabled=!1;function De(o,l,e,n=!1){let a=Ee();return e+=H.graphical.borderChunk,n?(a*=2,o>-r.screenWidth/a-e&&o<r.screenWidth/a+e&&l>-r.screenHeight/a-e&&l<r.screenHeight/a+e):o>-e&&o<r.screenWidth/a+e&&l>-e&&l<r.screenHeight/a+e}function L(o,l,e=3){let n=Date.now(),a=o,i=o;return{set:t=>{o!==t&&(i=a,o=t,n=Date.now())},get:()=>{let t=(Date.now()-n)/1e3;return a=t<l?i+(o-i)*Math.pow(t/l,1/e):o,a}}}var J=[],we=0,Ce=0,be=(()=>{let o=[];return{get:()=>{if(!o.length)return 0;var l=o.reduce(function(e,n){return e+n});return l/o.length},add:l=>{o.push(l),o.length>H.lag.memory&&o.splice(0,1)}}})(),Y=()=>Date.now()-we-Ce,b={vx:0,vy:0,lastvx:0,lastvy:0,renderx:b.x,rendery:b.y,lastx:b.x,lasty:b.y,target:window.canvas.target,name:"",lastUpdate:0,time:0},Ke=(()=>{let o=0,l=0,e=0,n=0;return{reset:()=>{o=0,l=0},get:()=>H.lag.unresponsive?{x:0,y:0}:{x:o,y:l},iterate:a=>{if(r.died||r.gameStart)return 0;let i=_.accel/_.topSpeed,t=Math.sqrt(a.x*a.x+a.y*a.y);e+=_.accel*a.x/t,n+=_.accel*a.y/t;let s=Math.sqrt(e*e+n*n);if(s>0&&i){let p=s/(i/Ie+1);e=p*e/s,n=p*n/s}o+=e,l+=n}}})(),Fe=(()=>{window.WebSocket=window.WebSocket||window.MozWebSocket;let o=(function(e={}){function n(){var a=new ArrayBuffer(2),i=new Uint8Array(a),t=new Uint16Array(a);if(i[0]=170,i[1]=187,t[0]===48042)return 0;if(t[0]===43707)return 1;throw new Error("Something crazy just happened")}return e.encode=(()=>{var a=new Uint8Array(1),i=new Uint16Array(1),t=new Uint8Array(i.buffer),s=new Uint32Array(1),p=new Uint8Array(s.buffer),m=new Float32Array(1),M=new Uint8Array(m.buffer),w=(f,d)=>{let v="";switch(f){case"RawUint8":return a[0]=d,String.fromCharCode(a[0]);case"RawUint16":return i[0]=d,String.fromCharCode(t[0],t[1]);case"Uint8":return a[0]=d,"0"+String.fromCharCode(a[0]);case"Uint16":return i[0]=d,"1"+String.fromCharCode(t[0],t[1]);case"Uint32":return s[0]=d,"2"+String.fromCharCode(p[0],p[1],p[2],p[3]);case"Sint8":return a[0]=-1-d,"3"+String.fromCharCode(a[0]);case"Sint16":return i[0]=-1-d,"4"+String.fromCharCode(t[0],t[1]);case"Sint32":return s[0]=-1-d,"5"+String.fromCharCode(p[0],p[1],p[2],p[3]);case"Float32":return m[0]=d,"6"+String.fromCharCode(M[0],M[1],M[2],M[3]);case"String8":return"7"+w("RawUint16",d.length)+d;case"String16":for(let A=0,C=d.length;A<C;A++)v+=w("RawUint16",d.charCodeAt(A));return"8"+w("RawUint16",v.length)+v;default:throw new Error("Unknown encoding type.")}},E=f=>{if(typeof f=="string"){for(var d=0;d<f.length;d++)if(f.charCodeAt(d)>255)return"String16";return"String8"}if(typeof f=="boolean")return"Uint8";if(typeof f!="number")throw new Error("Unencodable data type");if(f!=Math.round(f))return"Float32";if(f<0){if(f>=-256)return"Sint8";if(f>=-65535)return"Sint16";if(f>=-4294967295)return"Sint32"}else{if(f<256)return"Uint8";if(f<65535)return"Uint16";if(f<4294967295)return"Uint32"}return"Float32"};return(f,d=!1)=>{let v=f.splice(0,1)[0];if(typeof v!="string")throw new Error("No identification code!");f.forEach(c=>{v+=w(E(c),c)});let A=v.length,C=new ArrayBuffer(A),x=new Uint8Array(C);for(let c=0;c<A;c++)x[c]=v.charCodeAt(c);return d&&(console.log("OUTPUT: "+x),console.log("RAW OUTPUT: "+v),console.log("SIZE: "+A)),C}})(),e.decode=(()=>{var a=new Uint16Array(1),i=new Uint8Array(a.buffer),t=new Uint32Array(1),s=new Uint8Array(t.buffer),p=new Float32Array(1),m=new Uint8Array(p.buffer),M=(w,E,f)=>{switch(E){case"Uint8":return w.charCodeAt(f++);case"Uint16":for(let d=0;d<2;d++)i[d]=w.charCodeAt(f++);return a[0];case"Uint32":for(let d=0;d<4;d++)s[d]=w.charCodeAt(f++);return t[0];case"Sint8":return-1-w.charCodeAt(f++);case"Sint16":for(let d=0;d<2;d++)i[d]=w.charCodeAt(f++);return-1-a[0];case"Sint32":for(let d=0;d<4;d++)s[d]=w.charCodeAt(f++);return-1-t[0];case"Float32":for(let d=0;d<4;d++)m[d]=w.charCodeAt(f++);return p[0];default:throw new Error("Unknown decoding type.")}};return w=>{try{let E=new Uint8Array(w),f="";for(let A=0,C=E.length;A<C;A++)f+=String.fromCharCode(E[A]);let d=1,v=[f.charAt(0)];for(;d<f.length;)switch(f[d++]){case"0":v.push(M(f,"Uint8",d)),d++;break;case"1":v.push(M(f,"Uint16",d)),d+=2;break;case"2":v.push(M(f,"Uint32",d)),d+=4;break;case"3":v.push(M(f,"Sint8",d)),d++;break;case"4":v.push(M(f,"Sint16",d)),d+=2;break;case"5":v.push(M(f,"Sint32",d)),d+=4;break;case"6":v.push(M(f,"Float32",d)),d+=4;break;case"7":{let A=M(f,"Uint16",d);d+=2,v.push(f.slice(d,d+A)),d+=A}break;case"8":{let A=M(f,"Uint16",d);d+=2;let C=f.slice(d,d+A),x=new Uint16Array(A/2);for(let c=0;c<A;c+=2)x[c/2]=M(C,"Uint16",c);v.push(String.fromCharCode.apply(null,x)),d+=A}break;default:throw d=f.length,new Error("Unknown decoding command. Decoding exited.")}return v}catch(E){return console.log(E),-1}}})(),e})(),l=(()=>{let e=(()=>{let n=0,a=[];return{next:()=>{if(n>=a.length)throw console.log(a),new Error("Trying to crawl past the end of the provided data!");return a[n++]},set:i=>{a=i,n=0}}})();return{begin:n=>e.set(n),data:(()=>{let n=(()=>{let a=(()=>{function t(s){s.isUpdated=!0,(s.motion||s.position)&&(s.motion-=.2*s.position,s.position+=s.motion,s.position<0&&(s.position=0,s.motion=-s.motion),s.motion>0&&(s.motion*=.5))}return s=>{let p=[];for(let m=0;m<s;m++)p.push({motion:0,position:0,isUpdated:!0});return{getPositions:()=>p.map(m=>m.position),update:()=>p.forEach(t),fire:(m,M)=>{p[m].isUpdated&&(p[m].motion+=Math.sqrt(M)/20),p[m].isUpdated=!1},length:p.length}}})();function i(){let t="normal",s=Y();return{set:p=>{(p!==t||t==="injured")&&(t!=="dying"&&(s=Y()),t=p)},getFade:()=>t==="dying"||t==="killed"?1-Math.min(1,(Y()-s)/300):1,getColor:()=>"#FFFFFF",getBlend:()=>{let p=t==="normal"||t==="dying"?0:1-Math.min(1,(Y()-s)/80);return Y()-s>500&&t==="injured"&&(t="normal"),p}}}return(t={})=>{let s=t.facing==null,p=e.next();if(p&1)t.facing=e.next(),t.layer=e.next();else{t.interval=P.rendergap,t.id=e.next();let w=$.findIndex(E=>E.id===t.id);if(w!==-1&&(t=$.splice(w,1)[0]),s=w===-1,s||(t.render.draws=!0,t.render.lastx=t.x,t.render.lasty=t.y,t.render.lastvx=t.vx,t.render.lastvy=t.vy,t.render.lastf=t.facing,t.render.lastRender=b.time),t.index=e.next(),t.x=e.next(),t.y=e.next(),t.vx=e.next(),t.vy=e.next(),t.size=e.next(),t.facing=e.next(),t.vfacing=e.next(),t.twiggle=e.next(),t.layer=e.next(),t.color=e.next(),s)t.health=e.next()/255,t.shield=e.next()/255;else{let E=t.health,f=t.shield;t.health=e.next()/255,t.shield=e.next()/255,t.health<E||t.shield<f?t.render.status.set("injured"):t.render.status.getFade()!==1&&t.render.status.set("normal")}t.drawsHealth=!!(p&2),p&4&&(t.name=e.next(),t.score=e.next()),t.nameplate=p&4,s&&(t.render={draws:!1,expandsWithDeath:t.drawsHealth,lastRender:b.time,x:t.x,y:t.y,lastx:t.x-P.rendergap*H.roomSpeed*33.333333333333336*t.vx,lasty:t.y-P.rendergap*H.roomSpeed*33.333333333333336*t.vy,lastvx:t.vx,lastvy:t.vy,lastf:t.facing,f:t.facing,h:t.health,s:t.shield,interval:P.rendergap,slip:0,status:i(),health:L(t.health,.5,5),shield:L(t.shield,.5,5)}),t.render.health.set(t.health),t.render.shield.set(t.shield),!s&&t.oldIndex!==t.index&&(s=!0),t.oldIndex=t.index}let m=e.next();if(s)t.guns=a(m);else if(m!==t.guns.length)throw new Error("Mismatch between data gun number and remembered gun number!");for(let w=0;w<m;w++){let E=e.next(),f=e.next();E>b.lastUpdate-P.rendergap&&t.guns.fire(w,f)}let M=e.next();if(M){let w=1}if(s){t.turrets=[];for(let w=0;w<M;w++)t.turrets.push(n())}else{if(t.turrets.length!==M)throw new Error("Mismatch between data turret number and remembered turret number!");t.turrets.forEach(w=>{w=n(w)})}return t}})();return()=>{let a=[];for(let i=0,t=e.next();i<t;i++)a.push(n());$.forEach(i=>{i.render.status.set(i.health===1?"dying":"killed"),i.render.status.getFade()!==0&&De(i.render.x-b.renderx,i.render.y-b.rendery,i.size,!0)?a.push(i):i.render.textobjs!=null&&i.render.textobjs.forEach(t=>t.remove())}),$=a,$.sort((i,t)=>{let s=i.layer-t.layer;if(s||(s=t.id-i.id),!s)throw new Error("tha fuq is up now");return s})}})(),gui:()=>{let n=e.next(),a={topspeed:n&256,accel:n&128,skills:n&64,statsdata:n&32,upgrades:n&16,points:n&8,score:n&4,label:n&2,fps:n&1};if(a.fps&&(_.fps=e.next()),a.label&&(_.type=e.next(),_.color=e.next(),_.playerid=e.next()),a.score&&_.__s.setScore(e.next()),a.points&&(_.points=e.next()),a.upgrades){_.upgrades=[];for(let i=0,t=e.next();i<t;i++)_.upgrades.push(e.next())}if(a.statsdata)for(let i=9;i>=0;i--)_.skills[i].name=e.next(),_.skills[i].cap=e.next(),_.skills[i].softcap=e.next();if(a.skills){let i=parseInt(e.next(),36).toString(16);i="0000000000".substr(i.length)+i,_.skills[0].amount=parseInt(i.slice(0,1),16),_.skills[1].amount=parseInt(i.slice(1,2),16),_.skills[2].amount=parseInt(i.slice(2,3),16),_.skills[3].amount=parseInt(i.slice(3,4),16),_.skills[4].amount=parseInt(i.slice(4,5),16),_.skills[5].amount=parseInt(i.slice(5,6),16),_.skills[6].amount=parseInt(i.slice(6,7),16),_.skills[7].amount=parseInt(i.slice(7,8),16),_.skills[8].amount=parseInt(i.slice(8,9),16),_.skills[9].amount=parseInt(i.slice(9,10),16)}a.accel&&(_.accel=e.next()),a.topspeed&&(_.topspeed=e.next())},minimap:(()=>{let n=(()=>{function a(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}return()=>{let i=e.next(),t=e.next()*r.gameWidth/255,s=e.next()*r.gameHeight/255,p=e.next();switch(i){case-1:{let m=ie.findIndex(M=>a(M,[t,s,p]));m===-1?console.log("Warning: Remove request for a minimap node we were not aware of."):ie.splice(m,1)}break;case 1:ie.push([t,s,p]);break;default:console.log("Unknown minimap update request.")}}})();return()=>{for(let a=0,i=e.next();a<i;a++)n()}})(),leaderboard:()=>{let n=!1,a=e.next();if(a===-1)ne.purge();else for(let i=0,t=a;i<t;i++)ne.remove(e.next());for(let i=0,t=e.next();i<t;i++){let s=e.next();if(s<0){let p={id:-s,score:e.next(),index:e.next(),name:e.next(),color:e.next(),barcolor:e.next()};ne.add(p)}else ne.update({id:s,score:e.next(),index:e.next()})===-1&&(n=!0)}return n}}})();return e=>{let n=new WebSocket("ws://"+window.location.hostname+":"+e);return n.binaryType="arraybuffer",n.open=!1,n.cmd=(()=>{let a=!1,i=[!1,!1,!1,!1,!1,!1,!1,!1];return{set:(t,s)=>{i[t]!==s&&(i[t]=s,a=!0)},talk:()=>{a=!1;let t=0;for(let p=0;p<8;p++)i[p]&&(t+=Math.pow(2,p));let s=Ee();n.talk("C",Math.round(window.canvas.target.x/s),Math.round(window.canvas.target.y/s),t)},check:()=>a,getMotion:()=>({x:i[3]-i[2],y:i[1]-i[0]})}})(),n.talk=(...a)=>{if(!n.open)return 1;n.send(o.encode(a))},n.onopen=function(){n.open=!0,r.message="That token is invalid, expired, or already in use on this server. Please try another one!",n.talk("k",r.playerKey),console.log("Token submitted to the server for validation."),n.ping=i=>{n.talk("p",i)},n.commandCycle=setInterval(()=>{n.cmd.check()&&n.cmd.talk()})},n.onmessage=function(i){let t=o.decode(i.data);if(t===-1)throw new Error("Malformed packet.");switch(t.splice(0,1)[0]){case"w":t[0]&&(console.log("The server has welcomed us to the game room. Sending spawn request."),n.talk("s",r.playerName,1),r.message="");break;case"R":r.gameWidth=t[0],r.gameHeight=t[1],Q=JSON.parse(t[2]),Ce=JSON.parse(t[3]),H.roomSpeed=t[4],console.log("Room data recieved. Commencing syncing process."),n.talk("S",Y());break;case"c":b.renderx=b.x=t[0],b.rendery=b.y=t[1],b.renderv=b.view=t[2],console.log("Camera moved!");break;case"S":{let s=t[0],p=t[1],m=(Y()-s)/2,M=Y()-m-p;if(J.push({delta:M,latency:m}),J.length<10)setTimeout(()=>{n.talk("S",Y())},10),r.message="Syncing clocks, please do not tab away. "+J.length+"/10...";else{J.sort((v,A)=>v.latency-A.latency);let w=J[Math.floor(J.length/2)].latency,E=0,f=0,d=0;J.forEach(v=>{E+=Math.pow(v.latency-w,2)}),E=Math.sqrt(E/J.length),J.forEach(v=>{Math.abs(v.latency-w)<E&&(f+=v.delta,d++)}),we=Math.round(f/d),console.log(J),console.log("Syncing complete, calculated clock difference "+we+"ms. Beginning game."),r.gameStart=!0,r.message=""}}break;case"m":z.push({text:t[0],status:2,alpha:0,time:Date.now()});break;case"u":{let s=t[0],p=t[1],m=t[2],M=t[3],w=t[4],E=t[5],f=t.slice(6);s>b.lastUpdate?(be.add(Y()-s),b.time=s+be.get(),P.rendergap=s-b.lastUpdate,P.rendergap<=0&&console.log("yo some bullshit is up wtf"),b.lastUpdate=s,l.begin(f),l.gui(),l.data(),b.lastx=b.x,b.lasty=b.y,b.lastvx=b.vx,b.lastvy=b.vy,b.x=p,b.y=m,b.vx=r.died?0:w,b.vy=r.died?0:E,isNaN(b.renderx)&&(b.renderx=b.x),isNaN(b.rendery)&&(b.rendery=b.y),Ke.reset(),b.view=M,(isNaN(b.renderv)||b.renderv===0)&&(b.renderv=2e3),P.lastlag=P.lag,P.lastuplink=Y()):console.log("Old data! Last given time: "+b.time+"; offered packet timestamp: "+s+"."),n.talk("d",Math.max(b.lastUpdate,s)),n.cmd.talk(),pe++}break;case"b":l.begin(t),l.minimap(),l.leaderboard()&&n.talk("z");break;case"p":P.latency=r.time-t[0];break;case"F":{r.finalScore=L(0,4),r.finalScore.set(t[0]),r.finalLifetime=L(0,5),r.finalLifetime.set(t[1]),r.finalKills=[L(0,3),L(0,4.5),L(0,2.5)],r.finalKills[0].set(t[2]),r.finalKills[1].set(t[3]),r.finalKills[2].set(t[4]),r.finalKillers=[];for(let s=0;s<t[5];s++)r.finalKillers.push(t[6+s]);r.died=!0,window.onbeforeunload=()=>!1}break;case"K":window.onbeforeunload=()=>!1;break;default:throw new Error("Unknown message index.")}},n.onclose=function(){n.open=!1,r.disconnected=!0,clearInterval(n.commandCycle),window.onbeforeunload=()=>!1,console.log("Socket closed.")},n.onerror=function(i){console.log("WebSocket error: "+i),r.message="Socket error. Maybe another server will work."},n}})();function Ue(){switch(R.submitToLocalStorage("optScreenshotMode"),H.graphical.screenshotMode=document.getElementById("optScreenshotMode").checked,R.submitToLocalStorage("optFancy"),H.graphical.pointy=!document.getElementById("optNoPointy").checked,R.submitToLocalStorage("optNoPointy"),H.graphical.fancyAnimations=!document.getElementById("optFancy").checked,R.submitToLocalStorage("optPredictive"),H.lag.unresponsive=document.getElementById("optPredictive").checked,R.submitToLocalStorage("optBorders"),document.getElementById("optBorders").value){case"normal":H.graphical.darkBorders=H.graphical.neon=!1;break;case"dark":H.graphical.darkBorders=!0,H.graphical.neon=!1;break;case"glass":H.graphical.darkBorders=!1,H.graphical.neon=!0;break;case"neon":H.graphical.darkBorders=H.graphical.neon=!0;break}R.submitToLocalStorage("optColors");let o=document.getElementById("optColors").value;g=g[o===""?"normal":o];let l=document.getElementById("playerNameInput"),e=document.getElementById("playerKeyInput");R.submitToLocalStorage("playerNameInput"),R.submitToLocalStorage("playerKeyInput"),r.playerName=b.name=l.value,r.playerKey=e.value.replace(/(<([^>]+)>)/ig,"").substring(0,64),r.screenWidth=window.innerWidth,r.screenHeight=window.innerHeight,document.getElementById("startMenuWrapper").style.maxHeight="0px",document.getElementById("gameAreaWrapper").style.opacity=1,r.socket||(r.socket=Fe(3e3)),r.animLoopHandle||He(),window.canvas.socket=r.socket,ie=[],setInterval(()=>Ke.iterate(r.socket.cmd.getMotion()),1e3/30),document.getElementById("gameCanvas").focus(),window.onbeforeunload=()=>!0}function le(o,l){k.fillStyle=o,k.globalAlpha=l,k.fillRect(0,0,r.screenWidth,r.screenHeight),k.globalAlpha=1}var xe=(()=>{let o=document.createElement("div");return document.body.appendChild(o),(l,e,n=!1)=>{e+=H.graphical.fontSizeBoost;var a,i;return o.style.font="bold "+e+"px Ubuntu",o.style.padding="0",o.style.margin="0",o.style.position="absolute",o.style.visibility="hidden",o.innerHTML=l,a=o.clientWidth,i=o.clientHeight,n?{width:a,height:i}:a}})(),y=(()=>{let o=(e=null)=>{let n=!0;return{update:a=>{let i=!1;if(e==null)i=!0;else switch(typeof a!=typeof e&&(i=!0),typeof a){case"number":case"string":a!==e&&(i=!0);break;case"object":if(Array.isArray(a)){if(a.length!==e.length)i=!0;else for(let t=0,s=a.length;t<s;t++)a[t]!==e[t]&&(i=!0);break}default:throw console.log(a),new Error("Unsupported type for a floppyvar!")}i&&(n=!0,e=a)},publish:()=>e,check:()=>n?(n=!1,!0):!1}},l=0;return()=>{let e=document.createElement("canvas"),n="textCanvasNo"+l++;e.setAttribute("id",n);let a=e.getContext("2d");a.imageSmoothingEnabled=!1;let i=[o(""),o(0),o(0),o(1),o("#FF0000"),o("left")],t=i.map(m=>m.publish()),s=0,p=0;return{draw:(m,M,w,E,f,d="left",v=!1,A=1)=>{if(E+=H.graphical.fontSizeBoost,i[0].update(m),i[1].update(M),i[2].update(w),i[3].update(E),i[4].update(f),i[5].update(d),i.some(C=>C.check())){let C=Math.max(3,E/5),x=xe(m,E-H.graphical.fontSizeBoost,!0);switch(a.canvas.height=x.height+2*C,a.canvas.width=x.width+2*C,d){case"left":case"start":s=C;break;case"center":s=a.canvas.width/2;break;case"right":case"end":s=a.canvas.width-C;break}p=a.canvas.height/2,a.lineWidth=C,a.font="bold "+E+"px Ubuntu",a.textAlign=d,a.textBaseline="middle",a.strokeStyle=g.black,a.fillStyle=f,a.lineCap="round",a.lineJoin="round",a.strokeText(m,s,p),a.fillText(m,s,p)}k.save(),k.imageSmoothingEnabled=!1,k.drawImage(a.canvas,M-s,w-p*(1.05+!v*.45)),k.restore()},remove:()=>{var m=document.getElementById(n);m?.parentNode.removeChild(m)}}}})();function G(o,l,e,n,a=!1){switch(a){case!0:k.strokeRect(o,l,e,n);break;case!1:k.fillRect(o,l,e,n);break}}function Ae(o,l,e,n){k.beginPath(),k.lineTo(Math.round(o)+.5,Math.round(l)+.5),k.lineTo(Math.round(e)+.5,Math.round(n)+.5),k.closePath(),k.stroke()}function D(o,l,e,n,a){k.beginPath(),k.lineTo(o,e),k.lineTo(l,e),k.lineWidth=n,k.strokeStyle=a,k.closePath(),k.stroke()}var te=(()=>{function o(e,n,a,i,t,s=0,p=!0){if(s+=t%2?0:Math.PI/t,e.beginPath(),!t)e.arc(n,a,i,0,2*Math.PI);else if(t<0){H.graphical.pointy&&(e.lineJoin="miter");let f=1-6/t/t;t=-t,e.moveTo(n+i*Math.cos(s),a+i*Math.sin(s));for(let d=0;d<t;d++){var m=(d+1)/t*2*Math.PI,M=(d+.5)/t*2*Math.PI,w={x:n+i*f*Math.cos(M+s),y:a+i*f*Math.sin(M+s)},E={x:n+i*Math.cos(m+s),y:a+i*Math.sin(m+s)};e.quadraticCurveTo(w.x,w.y,E.x,E.y)}}else if(t>0)for(let f=0;f<t;f++){let d=f/t*2*Math.PI,v=n+i*Math.cos(d+s),A=a+i*Math.sin(d+s);e.lineTo(v,A)}e.closePath(),e.stroke(),p&&e.fill(),e.lineJoin="round"}function l(e,n,a,i,t,s,p){let m=[];m=s>0?[t*s,t]:[t,-t*s];let M=[Math.atan2(m[0],i),Math.atan2(m[1],i)],w=[Math.sqrt(i*i+m[0]*m[0]),Math.sqrt(i*i+m[1]*m[1])];e.beginPath(),e.lineTo(n+w[0]*Math.cos(p+M[0]),a+w[0]*Math.sin(p+M[0])),e.lineTo(n+w[1]*Math.cos(p+Math.PI-M[1]),a+w[1]*Math.sin(p+Math.PI-M[1])),e.lineTo(n+w[1]*Math.cos(p+Math.PI+M[1]),a+w[1]*Math.sin(p+Math.PI+M[1])),e.lineTo(n+w[0]*Math.cos(p-M[0]),a+w[0]*Math.sin(p-M[0])),e.closePath(),e.stroke(),e.fill()}return(e,n,a,i,t=1,s=0,p=!1,m=!1,M=!1,w=a.render)=>{let E=m||k,f=M?1:w.status.getFade(),d=t*i*a.size,v=N[a.index],A=e,C=n,x=M===!1?a:M;if(w.expandsWithDeath&&(d*=1+.5*(1-f)),H.graphical.fancyAnimations&&m!=ye&&f!==1&&(E=ye,E.canvas.width=E.canvas.height=d*v.position.axis+i*20,A=E.canvas.width/2-d*v.position.axis*v.position.middle.x*Math.cos(s)/4,C=E.canvas.height/2-d*v.position.axis*v.position.middle.x*Math.sin(s)/4),E.lineCap="round",E.lineJoin="round",x.turrets.length===v.turrets.length)for(let c=0;c<v.turrets.length;c++){let h=v.turrets[c];if(h.layer===0){let u=h.direction+h.angle+s,S=h.offset*d;te(A+S*Math.cos(u),C+S*Math.sin(u),h,i,d/i/h.size*h.sizeFactor,x.turrets[c].facing+p*s,p,E,x.turrets[c],w)}}else throw new Error("Mismatch turret number with mockup.");if(x.guns.update(),E.lineWidth=Math.max(H.graphical.mininumBorderChunk,i*H.graphical.borderChunk),Me(E,re(g.grey,w.status.getColor(),w.status.getBlend())),x.guns.length===v.guns.length){let c=x.guns.getPositions();for(let h=0;h<v.guns.length;h++){let u=v.guns[h],S=c[h]/(u.aspect===1?2:1),K=u.offset*Math.cos(u.direction+u.angle+s)+(u.length/2-S)*Math.cos(u.angle+s),U=u.offset*Math.sin(u.direction+u.angle+s)+(u.length/2-S)*Math.sin(u.angle+s);l(E,A+d*K,C+d*U,d*(u.length/2-(u.aspect===1?S*2:0)),d*u.width/2,u.aspect,u.angle+s)}}else throw new Error("Mismatch gun number with mockup.");if(E.globalAlpha=1,Me(E,re(ee(a.color),w.status.getColor(),w.status.getBlend())),o(E,A,C,d/v.size*v.realSize,v.shape,s),x.turrets.length===v.turrets.length)for(let c=0;c<v.turrets.length;c++){let h=v.turrets[c];if(h.layer===1){let u=h.direction+h.angle+s,S=h.offset*d;te(A+S*Math.cos(u),C+S*Math.sin(u),h,i,d/i/h.size*h.sizeFactor,x.turrets[c].facing+p*s,p,E,x.turrets[c],w)}}else throw new Error("Mismatch turret number with mockup.");m==!1&&E!=k&&(k.save(),k.globalAlpha=f,k.imageSmoothingEnabled=!1,k.filter="blur("+Math.round(H.graphical.deathBlurAmount-H.graphical.deathBlurAmount*f)+"px)",k.drawImage(E.canvas,e-A,n-C),k.restore())}})();function Oe(o,l,e,n){k.globalAlpha=Math.pow(e.render.status.getFade(),2);let a=e.size*n,i=N[e.index],t=a/i.size*i.realSize;if(e.drawsHealth){let s=e.render.health.get(),p=e.render.shield.get();if(s<1||p<1){let m=l+1.1*t+15;D(o-a,o+a,m,3+H.graphical.barChunk,g.black),D(o-a,o-a+2*a*s,m,3,g.lgreen),p&&(k.globalAlpha=.3+p*.3,D(o-a,o-a+2*a*p,m,3,g.teal),k.globalAlpha=1)}}e.nameplate&&e.id!==_.playerid&&(e.render.textobjs==null&&(e.render.textobjs=[y(),y()]),e.name!=="\0"?(e.render.textobjs[0].draw(e.name,o,l-t-30,16,g.guiwhite,"center"),e.render.textobjs[1].draw(R.handleLargeNumber(e.score,!0),o,l-t-16,8,g.guiwhite,"center")):(e.render.textobjs[0].draw("a spoopy \u{1F47B}",o,l-t-30,16,g.lavender,"center"),e.render.textobjs[1].draw(R.handleLargeNumber(e.score,!0),o,l-t-16,8,g.lavender,"center")))}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(o){};window.cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;var Ye=(()=>{let o=L(0,.7,1.5),l=L(0,2,3);function e(){var m=[];return(M,w,E,f,d,v)=>{for(m.push(M);m.length>f;)m.splice(0,1);let A=Math.min(...m),C=Math.max(...m),x=C-A;C>0&&A<0&&D(w,w+f,E+d*C/x,2,g.guiwhite),k.beginPath();let c=-1;m.forEach(h=>{++c?k.lineTo(w+c,E+d*(C-h)/x):k.moveTo(w,E+d*(C-h)/x)}),k.lineWidth=1,k.strokeStyle=v,k.stroke()}}let n=(()=>{function m(E,f,d,v,A,C){let x=Math.cos((1+C)*Math.PI);return .5*(((1+C)*d+E)*(x+1)+(-C*v+f)*(1-x))}function M(E,f,d,v,A,C){return f+(f-E)*C}function w(E,f){let d=function(A,C){return(A%C+C)%C},v=f-E;return d(v+Math.PI,2*Math.PI)-Math.PI}return()=>{let E=0,f=0,d=0,v=0;return{set:(A=b.time,C=P.rendergap)=>{f=Math.max(Y()-A-80,-C),f>150&&f<1e3&&(f=150),f>1e3&&(f=1e3*1e3*Math.sin(f/1e3-1)/f+1e3),d=f/C,v=H.roomSpeed*30*f/1e3},predict:(A,C,x,c)=>f>=0?M(A,C,x,c,v,d):m(A,C,x,c,v,d),predictFacing:(A,C)=>A+(1+d)*w(A,C),getPrediction:()=>f}}})(),a=e(),i=e(),t=e(),s=(()=>{function m(w){return Math.log(4*w+1)/Math.log(5)}let M=[];for(let w=0;w<H.gui.expectedMaxSkillLevel*2;w++)M.push(m(w/H.gui.expectedMaxSkillLevel));return w=>M[w]})(),p={skillNames:[y(),y(),y(),y(),y(),y(),y(),y(),y(),y()],skillKeys:[y(),y(),y(),y(),y(),y(),y(),y(),y(),y()],skillValues:[y(),y(),y(),y(),y(),y(),y(),y(),y(),y()],skillPoints:y(),score:y(),name:y(),class:y(),debug:[y(),y(),y(),y(),y(),y(),y()],lbtitle:y(),leaderboard:[y(),y(),y(),y(),y(),y(),y(),y(),y(),y()],upgradeNames:[y(),y(),y(),y(),y(),y(),y(),y()],upgradeKeys:[y(),y(),y(),y(),y(),y(),y(),y()],skipUpgrades:y()};return m=>{let M=0;ge++;let w,E;{let x=n();x.set();let c={x:0,y:0};M=x.getPrediction(),b.renderx=x.predict(b.lastx,b.x,b.lastvx,b.vx)+c.x,b.rendery=x.predict(b.lasty,b.y,b.lastvy,b.vy)+c.y,w=m*b.renderx,E=m*b.rendery}{le(g.white,1),le(g.guiblack,.1);let x=Q[0].length,c=Q.length,h=0;Q.forEach(S=>{let K=0;S.forEach(U=>{let W=Math.max(0,m*K*r.gameWidth/x-w+r.screenWidth/2),I=Math.max(0,m*h*r.gameHeight/c-E+r.screenHeight/2),j=Math.min(r.screenWidth,m*(K+1)*r.gameWidth/x-w+r.screenWidth/2),B=Math.min(r.screenHeight,m*(h+1)*r.gameHeight/c-E+r.screenHeight/2);k.globalAlpha=1,k.fillStyle=H.graphical.screenshotMode?g.guiwhite:g.white,k.fillRect(W,I,j-W,B-I),k.globalAlpha=.3,k.fillStyle=H.graphical.screenshotMode?g.guiwhite:ve(U,!0),k.fillRect(W,I,j-W,B-I),K++}),h++}),k.lineWidth=1,k.strokeStyle=H.graphical.screenshotMode?g.guiwhite:g.guiblack,k.globalAlpha=.04,k.beginPath();let u=30*m;for(let S=(r.screenWidth/2-w)%u;S<r.screenWidth;S+=u)k.moveTo(S,0),k.lineTo(S,r.screenHeight);for(let S=(r.screenHeight/2-E)%u;S<r.screenHeight;S+=u)k.moveTo(0,S),k.lineTo(r.screenWidth,S);k.stroke(),k.globalAlpha=1}$.forEach(function(c){if(!c.render.draws)return 1;let h=n();c.render.status.getFade()===1?h.set():h.set(c.render.lastRender,c.render.interval),c.render.x=h.predict(c.render.lastx,c.x,c.render.lastvx,c.vx),c.render.y=h.predict(c.render.lasty,c.y,c.render.lastvy,c.vy),c.render.f=c.id===_.playerid&&!c.twiggle?Math.atan2(fe.y,fe.x):h.predictFacing(c.render.lastf,c.facing);let u=c.id===_.playerid?0:m*c.render.x-w,S=c.id===_.playerid?0:m*c.render.y-E;u+=r.screenWidth/2,S+=r.screenHeight/2,te(u,S,c,m,1.1,c.render.f)}),H.graphical.screenshotMode||$.forEach(function(c){let h=c.id===_.playerid?0:m*c.render.x-w,u=c.id===_.playerid?0:m*c.render.y-E;h+=r.screenWidth/2,u+=r.screenHeight/2,Oe(h,u,c,m)});let f=200/Math.max(r.screenWidth,r.screenHeight*16/9),d=20;_.__s.update();let v=ne.get(),A=v.max;{let x=4,c=0,h=18,u=r.screenWidth/2,S=d;for(let K=z.length-1;K>=0;K--){let U=z[K],W=U.text,I=W;U.textobj==null&&(U.textobj=y()),U.len==null&&(U.len=xe(I,h-4)),k.globalAlpha=.5*U.alpha,D(u-U.len/2,u+U.len/2,S+h/2,h,g.black),k.globalAlpha=Math.min(1,U.alpha),U.textobj.draw(I,u,S+h/2,h-4,g.guiwhite,"center",!0),S+=x+h,U.status>1&&(S-=(x+h)*(1-Math.sqrt(U.alpha))),U.status>1?(U.status-=.05,U.alpha+=.05):K===0&&(z.length>5||Date.now()-U.time>1e4)&&(U.status-=.05,U.alpha-=.05,U.alpha<=0&&(z[0].textobj.remove(),z.splice(0,1)))}k.globalAlpha=1}{r.canSkill=!!_.points,o.set(0+(r.canSkill||r.died||r.statHover)),r.clickables.stat.hide();let x=4,c=15,h=35,u=f*r.screenWidth,S=u,K=-d-2*u+o.get()*(2*d+2*u),U=r.screenHeight-d-c,W=11,I=_.getStatNames(N[_.type].statnames||-1);_.skills.forEach(function(B){W--;let ae=I[W-1],O=B.amount,X=g[B.color],F=B.softcap,q=B.cap;if(F){u=S;let V=H.gui.expectedMaxSkillLevel,oe=F>V,se=F<q;if(oe&&(V=F),D(K+c/2,K-c/2+u*s(F),U+c/2,c-3+H.graphical.barChunk,g.black),D(K+c/2,K+c/2+(u-h)*s(F),U+c/2,c-3,g.grey),D(K+c/2,K+c/2+(u-h)*s(O),U+c/2,c-3.5,X),se){k.lineWidth=1,k.strokeStyle=g.grey;for(let T=F+1;T<V;T++)Ae(K+(u-h)*s(T),U+1.5,K+(u-h)*s(T),U-3+c)}k.strokeStyle=g.black,k.lineWidth=1;for(let T=1;T<O+1;T++)Ae(K+(u-h)*s(T),U+1.5,K+(u-h)*s(T),U-3+c);u=S*s(V);let Z=O==q?X:!_.points||F!==q&&O==F?g.grey:g.guiwhite;p.skillNames[W-1].draw(ae,Math.round(K+u/2)+.5,U+c/2,c-5,Z,"center",!0),p.skillKeys[W-1].draw("["+W%10+"]",Math.round(K+u-c*.25)-1.5,U+c/2,c-5,Z,"right",!0),Z===g.guiwhite&&r.clickables.stat.place(W-1,K,U,u,c),O&&p.skillValues[W-1].draw(Z===X?"MAX":"+"+O,Math.round(K+u+4)+.5,U+c/2,c-5,X,"left",!0),U-=c+x}}),r.clickables.hover.place(0,0,U,.8*u,.8*(r.screenHeight-U)),_.points!==0&&p.skillPoints.draw("x"+_.points,Math.round(K+u-2)+.5,Math.round(U+c-4)+.5,20,g.guiwhite,"right")}{let x=4,c=1.65*f*r.screenWidth,h=25,u=(r.screenWidth-c)/2,S=r.screenHeight-d-h;k.lineWidth=1,D(u,u+c,S+h/2,h-3+H.graphical.barChunk,g.black),D(u,u+c,S+h/2,h-3,g.grey),D(u,u+c*_.__s.getProgress(),S+h/2,h-3.5,g.gold),p.class.draw("Level "+_.__s.getLevel()+" "+N[_.type].name,u+c/2,S+h/2,h-4,g.guiwhite,"center",!0),h=14,S-=h+x,D(u+c*.1,u+c*.9,S+h/2,h-3+H.graphical.barChunk,g.black),D(u+c*.1,u+c*.9,S+h/2,h-3,g.grey),D(u+c*.1,u+c*(.1+.8*(A?Math.min(1,_.__s.getScore()/A):1)),S+h/2,h-3.5,g.green),p.score.draw("Score: "+R.handleLargeNumber(_.__s.getScore()),u+c/2,S+h/2,h-2,g.guiwhite,"center",!0),k.lineWidth=4,p.name.draw(b.name,Math.round(u+c/2)+.5,Math.round(S-10-x)+.5,32,g.guiwhite,"center")}{let x=f*r.screenWidth,c=x,h=r.screenWidth-x-d,u=r.screenHeight-c-d;k.globalAlpha=.5;let S=Q[0].length,K=Q.length,U=0;Q.forEach(W=>{let I=0;W.forEach(j=>{k.fillStyle=ve(j,!1),G(h+I++*x/S,u+U*c/K,x/S,c/K)}),U++}),k.fillStyle=g.grey,G(h,u,x,c),ie.forEach(W=>{W[2]===17?(k.fillStyle=re(ee(W[2]),g.black,.5),k.globalAlpha=.8,G(h+W[0]/r.gameWidth*x,u+W[1]/r.gameHeight*c,1,1)):(k.strokeStyle=re(ee(W[2]),g.black,.5),k.lineWidth=1,k.globalAlpha=1,G(h+W[0]/r.gameWidth*x-1,u+W[1]/r.gameWidth*c-1,3,3,!0),k.lineWidth=3)}),k.globalAlpha=1,k.lineWidth=1,k.strokeStyle=g.black,G(h+b.x/r.gameWidth*x-1,u+b.y/r.gameWidth*c-1,3,3,!0),k.lineWidth=3,k.fillStyle=g.black,G(h,u,x,c,!0),G(h,u-40,x,30),i(be.get(),h,u-40,x,30,g.teal),t(P.rendergap,h,u-40,x,30,g.pink),a(M,h,u-40,x,30,g.yellow),p.debug[5].draw("Prediction: "+Math.round(M)+"ms",h+x,u-50-70,10,g.guiwhite,"right"),p.debug[4].draw("Update Rate: "+P.updatetime+"Hz",h+x,u-50-56,10,g.guiwhite,"right"),p.debug[3].draw("Latency: "+P.latency+"ms",h+x,u-50-42,10,g.guiwhite,"right"),p.debug[2].draw("Client FPS: "+P.rendertime,h+x,u-50-28,10,g.guiwhite,"right"),p.debug[1].draw("Server Speed: "+(100*_.fps).toFixed(2)+"%"+(_.fps===1?"":" OVERLOADED!"),h+x,u-50-14,10,_.fps===1?g.guiwhite:g.orange,"right"),p.debug[0].draw(de,h+x,u-50,10,g.guiwhite,"right")}{let x=4,c=f*r.screenWidth,h=14,u=r.screenWidth-c-d,S=d+h+7;p.lbtitle.draw("Leaderboard:",Math.round(u+c/2)+.5,Math.round(S-6)+.5,h+4,g.guiwhite,"center");let K=0;v.data.forEach(U=>{D(u,u+c,S+h/2,h-3+H.graphical.barChunk,g.black),D(u,u+c,S+h/2,h-3,g.grey);let W=Math.min(1,U.score/A);D(u,u+c*W,S+h/2,h-3.5,U.barcolor),p.leaderboard[K++].draw(U.label+": "+R.handleLargeNumber(Math.round(U.score)),u+c/2,S+h/2,h-5,g.guiwhite,"center",!0);let I=h/U.position.axis,j=u-1.5*h-I*U.position.middle.x*.707,B=S+.5*h+I*U.position.middle.x*.707;te(j,B,U.image,1/I,I*I/U.image.size,-Math.PI/4,!0),S+=x+h})}{l.set(0+(r.canUpgrade||r.upgradeHover));let x=l.get();if(r.clickables.upgrade.hide(),_.upgrades.length>0){r.canUpgrade=!0;var C=function(oe){switch(oe){case 0:return"y";case 1:return"h";case 2:return"u";case 3:return"j";case 4:return"i";case 5:return"k";case 6:return"o";case 7:return"l"}};let c=8,h=f*r.screenWidth/2*1,u=h,S=x*2*d-d,K=d,U=S,W=0,I=K,j=0;ce+=.01;let B=10,ae=0;_.upgrades.forEach(function(se){K>I&&(I=K),W=S,r.clickables.upgrade.place(ae++,S,K,h,u),k.globalAlpha=.5,k.fillStyle=ee(B),G(S,K,h,u),k.globalAlpha=.1,k.fillStyle=ee(-10+B++),G(S,K,h,u*.6),k.fillStyle=g.black,G(S,K+u*.6,h,u*.4),k.globalAlpha=1;let Z=he(se,_.color),T=N[se].position,ue=.6*h/T.axis,We=S+.5*h-ue*T.middle.x*Math.cos(ce),Re=K+.5*u-ue*T.middle.x*Math.sin(ce);te(We,Re,Z,1,ue/Z.size,ce,!0),p.upgradeNames[ae-1].draw(Z.name,S+.9*h/2,K+u-6,u/8-3,g.guiwhite,"center"),p.upgradeKeys[ae-1].draw("["+C(j)+"]",S+h-4,K+u-6,u/8-3,g.guiwhite,"right"),k.strokeStyle=g.black,k.globalAlpha=1,k.lineWidth=3,G(S,K,h,u,!0),j++%2?(K-=u+c,S+=x*(h+c)):K+=u+c});let O=14,X="Don't Upgrade",F=xe(X,O-3)+10,q=U+(W+h+c-U)/2,V=I+u+c;D(q-F/2,q+F/2,V+O/2,O+H.graphical.barChunk,g.black),D(q-F/2,q+F/2,V+O/2,O,g.white),p.skipUpgrades.draw(X,q,V+O/2,O-2,g.guiwhite,"center",!0),r.clickables.skipUpgrades.place(0,q-F/2,V,F,O)}else r.canUpgrade=!1,r.clickables.upgrade.hide(),r.clickables.skipUpgrades.hide()}P.lastrender=Y()}})(),Te=(()=>{let o={taunt:y(),level:y(),score:y(),time:y(),kills:y(),death:y(),playagain:y()},l=()=>{let n=[Math.round(r.finalKills[0].get()),Math.round(r.finalKills[1].get()),Math.round(r.finalKills[2].get())],a=n[0]+.5*n[1]+3*n[2];return(a===0?"\u{1F33C}":a<4?"\u{1F3AF}":a<8?"\u{1F4A5}":a<15?"\u{1F4A2}":a<25?"\u{1F525}":a<50?"\u{1F4A3}":a<75?"\u{1F47A}":a<100?"\u{1F336}\uFE0F":"\u{1F4AF}")+(n[0]||n[1]||n[2]?" "+(n[0]?n[0]+" kills":"")+(n[0]&&n[1]?" and ":"")+(n[1]?n[1]+" assists":"")+((n[0]||n[1])&&n[2]?" and ":"")+(n[2]?n[2]+" visitors defeated":""):" A true pacifist")+"."},e=()=>{let n="";return r.finalKillers.length?(n="\u{1F52A} Succumbed to",r.finalKillers.forEach(a=>{n+=" "+R.addArticle(N[a].name)+" and"}),n=n.slice(0,-4)+"."):n+="\u{1F937} Well that was kinda dumb huh",n};return()=>{le(g.black,.25);let n=r.screenWidth/2,a=r.screenHeight/2-50,i=he(_.type,_.color),t=140,s=N[_.type].position,p=t/s.axis,m=r.screenWidth/2-p*s.middle.x*.707,M=r.screenHeight/2-35+p*s.middle.x*.707;te(m-190-t/2,M-10,i,1.5,.5*p/i.realSize,-Math.PI/4,!0),o.taunt.draw("lol you died",n,a-80,8,g.guiwhite,"center"),o.level.draw("Level "+_.__s.getLevel()+" "+N[_.type].name+".",n-170,a-30,24,g.guiwhite),o.score.draw("Final score: "+R.formatLargeNumber(Math.round(r.finalScore.get())),n-170,a+25,50,g.guiwhite),o.time.draw("\u231A Survived for "+R.timeForHumans(Math.round(r.finalLifetime.get()))+".",n-170,a+55,16,g.guiwhite),o.kills.draw(l(),n-170,a+77,16,g.guiwhite),o.death.draw(e(),n-170,a+99,16,g.guiwhite),o.playagain.draw("Press enter to play again!",n,a+125,16,g.guiwhite,"center")}})(),Be=(()=>{let o={connecting:y(),message:y()};return()=>{le(g.white,.5),o.connecting.draw("Connecting...",r.screenWidth/2,r.screenHeight/2,30,g.guiwhite,"center"),o.message.draw(r.message,r.screenWidth/2,r.screenHeight/2+30,15,g.lgreen,"center")}})(),Le=(()=>{let o={disconnected:y(),message:y()};return()=>{le(re(g.red,g.guiblack,.3),.25),o.disconnected.draw("\u{1F480} Disconnected. \u{1F480}",r.screenWidth/2,r.screenHeight/2,30,g.guiwhite,"center"),o.message.draw(r.message,r.screenWidth/2,r.screenHeight/2+30,15,g.orange,"center")}})();function He(){r.animLoopHandle=window.requestAnimFrame(He),b.renderv+=(b.view-b.renderv)/30;var o=H.graphical.screenshotMode?2:Ee();k.lineCap="round",k.lineJoin="round",k.filter="none",r.gameStart&&!r.disconnected&&(r.time=Y(),r.time-_e>1e3&&(r.socket.ping(r.time),_e=r.time,P.rendertime=ge,ge=0,P.updatetime=pe,pe=0),P.lag=r.time-b.time),r.gameStart?Ye(o):r.disconnected||Be(),r.died&&Te(),r.disconnected&&Le()}})();
//# sourceMappingURL=bundle.js.map
